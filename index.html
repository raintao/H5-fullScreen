<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>H5</title>
  <link rel="stylesheet" href="index.css">
  </head>
  <body>
    <div class="divList active" data-tar="1"><p></p></div>
    <div class="divList" data-tar="2"><p></p></div>
    <div class="divList" data-tar="3"><p></p></div>
    <div class="divList" data-tar="4"><p></p></div>
    <div class="divList" data-tar="5"><p></p></div>
    <script src="jquery-1.11.3.min.js"></script>
    <script type="text/javascript">
    $(function(){
      // 让每个列表充满整个屏幕
      $(".divList").css("height",$(window).height());
      // 初始化数据，其中listNum为当前列表的个数
      var arr=[0,0],listNum=5,startY=0,deltaY=0,canMove=false;
      document . addEventListener ( "touchstart" , function ( e ) {
        e . preventDefault ( ) ;
        // 获取开始触屏时的位置
        var touch = e . touches [ 0 ] ;
        // startX = touch . pageX ;
        startY = touch . pageY ;
        arr[0]=startY; //保存刚开始触屏时的数据
        console.log("start:"+startY);
      });
      document . addEventListener ( "touchmove" , function ( e ) {
        e . preventDefault ( ) ;
        var touch = e . touches [ 0 ] ;
        // deltaX = touch . pageX -startX;
        deltaY = touch . pageY;
        canMove=true;  //判断是触屏还是点击屏幕，如果为点击，canMove默认为false
        console.log(canMove);
      });
      document . addEventListener ( "touchend" , function ( e ) {
        e . preventDefault ( ) ;
        console.log("end:"+deltaY);
        arr[1]=deltaY; //保存触屏结束的数据
        if(canMove&&arr[1]-arr[0]>30){
          var tar=parseInt($(".divList.active").attr("data-tar"))+1;
          if(tar>=listNum+1){tar=1;} //如果切换的是最后一个，则循环播放
          console.log("下个现实的列表为:"+tar);
          // 让要现实的列表瞬间下移动自己的高度
          $("[data-tar='"+tar+"']").css("transform","translateY(100%)");
          // 添加transition，block样式，下滑时的定位z-index:2
          $("[data-tar='"+tar+"']").addClass("active current");
          // 一次性定时器，形成一个瞬间时间差，然后可以让动画在上移回来
          var timer=setTimeout(function(){
            // 执行动画缓慢下滑
            $("[data-tar='"+tar+"']").css("transform","translateY(0)");
            clearTimeout(timer);
            timer=null;//清除定时器放在下一个之前，不然下一个定时器不执行
            // 列表css动画结束后，要执行的内容，时间为css动画的时间
            var timer=setTimeout(function(){
              // 动画结束后，要移除上一个的属性z-index:0,同事目标z-index恢复1
              console.log((tar-1)<=0?listNum:tar-1);
              $("[data-tar='"+((tar-1)<=0?listNum:tar-1)+"']").removeClass("active");
              $("[data-tar='"+tar+"']").removeClass("current");
              // 动画结束后，可以给列表内的元素添加移动的样式了
              $("[data-tar='"+tar+"']>p").addClass("active");
              clearTimeout(timer);
              timer=null;
              // 留给列表内同一元素执行二次动画的
              var timer=setTimeout(function(){
                $("[data-tar='"+tar+"']>p").addClass("actives");
                clearTimeout(timer);
                timer=null;
              },400);
            },400);
          },10);
        }else if(canMove&&arr[1]-arr[0]<-30){
          var tar=parseInt($(".divList.active").attr("data-tar"))-1;
          if(tar<=0){tar=listNum;}
          console.log("上移的目标位:"+tar);
          $("[data-tar='"+tar+"']").css("transform","translateY(-100%)");
          $("[data-tar='"+tar+"']").addClass("active current");
          var timer=setTimeout(function(){
            $("[data-tar='"+tar+"']").css("transform","translateY(0)");
            clearTimeout(timer);
            timer=null;
            var timer=setTimeout(function(){
              $("[data-tar='"+((tar+1)>listNum?1:tar+1)+"']").removeClass("active");
              $("[data-tar='"+tar+"']").removeClass("current");
              clearTimeout(timer);
              timer=null;
              $("[data-tar='"+tar+"']>p").addClass("active");
              var timer=setTimeout(function(){
                $("[data-tar='"+tar+"']>p").addClass("actives");
                clearTimeout(timer);
                timer=null;
              },400);
            },400);
          },10);
        }
        canMove=false;
      });
    });
    </script>
  </body>
</html>
